<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>AD&D 2e Roller</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      text-align: center;
      padding: 2rem;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      margin-top: 1rem;
      cursor: pointer;
    }
    #result {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Thac0 Roller</h1>

  <label>
    Thac0:
    <input type="number" id="thac0">
  </label><br><br>

  <label>
    Modyfikator siły:
    <input type="number" id="strMod">
  </label><br><br>

  <label>
    Inne modyfikatory:
    <input type="number" id="otherMod">
  </label><br><br>

  <button id="rollButton">Rzut</button><br><br>

  <input type="text" id="resultBox" readonly>

  <script>
    const thac0Input = document.getElementById("thac0");
    const strModInput = document.getElementById("strMod");
    const otherModInput = document.getElementById("otherMod");
    const resultBox = document.getElementById("resultBox");

    // Wczytaj zapamiętane wartości
    thac0Input.value = localStorage.getItem("thac0") || "";
    strModInput.value = localStorage.getItem("strMod") || "";
    otherModInput.value = localStorage.getItem("otherMod") || "";

    // Zapisuj przy zmianie
    thac0Input.oninput = () => localStorage.setItem("thac0", thac0Input.value);
    strModInput.oninput = () => localStorage.setItem("strMod", strModInput.value);
    otherModInput.oninput = () => localStorage.setItem("otherMod", otherModInput.value);

    document.getElementById("rollButton").onclick = function () {
      const thac0 = Number(thac0Input.value) || 0;
      const strMod = Number(strModInput.value) || 0;
      const otherMod = Number(otherModInput.value) || 0;

      const roll = Math.floor(Math.random() * 20) + 1;
      const totalMods = roll + strMod + otherMod;
      const result = thac0 - totalMods;

      resultBox.value = `Rzut: ${roll} | Wynik: ${result}`;
    };
  </script>

  <h1>Thac0 Roller</h1>

  <input id="name" placeholder="Twoje imię"><br><br>

  <input id="thac0" type="number" placeholder="Thac0">
  <input id="strMod" type="number" placeholder="Mod siły">
  <input id="otherMod" type="number" placeholder="Inne mody"><br><br>

  <button id="rollBtn">Rzut</button>

  <h2>Ostatnie rzuty:</h2>
  <ul id="log"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "TU_WSTAW_CONFIG",
      authDomain: "...",
      databaseURL: "...",
      projectId: "...",
      storageBucket: "...",
      messagingSenderId: "...",
      appId: "..."
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const rollsRef = ref(db, "rolls");

    document.getElementById("rollBtn").onclick = () => {
      const name = document.getElementById("name").value || "Anon";
      const thac0 = +document.getElementById("thac0").value || 0;
      const str = +document.getElementById("strMod").value || 0;
      const other = +document.getElementById("otherMod").value || 0;

      const d20 = Math.floor(Math.random() * 20) + 1;
      const result = thac0 - (d20 + str + other);

      push(rollsRef, {
        name,
        d20,
        total: result,
        time: Date.now()
      });
    };

    onChildAdded(rollsRef, snap => {
      const r = snap.val();
      const li = document.createElement("li");
      li.textContent = `${r.name} rzuca: ${r.d20} → wynik: ${r.total}`;
      document.getElementById("log").prepend(li);
    });
  </script>
  
</body>
</html>
